{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Alex\\\\Downloads\\\\react-portfolio-master\\\\react-portfolio-master\\\\src\\\\Components\\\\Movies.js\";\nimport React, { Component } from 'react';\nimport MovieGallery from './MovieGallery';\nimport config from '../config.js';\n\nconst movies = require('../movies.json');\n\nconst firebase = require('firebase');\n/*\n  3. Pagination\n    - first only display 8\n    - display more by 8 (or less than 8 if not a multiple of 8)\n*/\n\n\nexport class Movies extends Component {\n  constructor(props) {\n    super();\n\n    this.myChangeHandler = event => {\n      let field = event.target.name;\n      let value = event.target.value;\n      this.setState({\n        [field]: value\n      });\n      let listChoice = document.getElementById('list').value;\n\n      if (listChoice === 'all') {\n        let ref = firebase.database().ref('movies');\n        ref.once('value').then(snapshot => {\n          //ref.on('value', snapshot => {\n          let movies = snapshot.val();\n          let newData = [];\n\n          for (let entry in movies) {\n            newData.push({\n              id: entry,\n              name: movies[entry].name,\n              src: movies[entry].src,\n              director: movies[entry].director,\n              imdb: movies[entry].imdb,\n              plot: movies[entry].plot\n            });\n          }\n\n          this.setState({\n            lastMov: newData[newData.length - 1]\n          });\n\n          if (newData.length < 9) {\n            this.setState({\n              displayButton: 'none'\n            });\n          } else {\n            this.setState({\n              displayButton: 'block'\n            });\n          }\n        }); // PAGINATION\n\n        let first = ref.orderByKey().limitToFirst(9);\n        first.once('value').then(snapshot => {\n          //first.on('value', snapshot => {\n          let firstMovs = snapshot.val();\n          let currEight = [];\n\n          for (let entry in firstMovs) {\n            currEight.push({\n              id: entry,\n              name: firstMovs[entry].name,\n              src: firstMovs[entry].src,\n              director: firstMovs[entry].director,\n              imdb: firstMovs[entry].imdb,\n              plot: firstMovs[entry].plot\n            });\n          }\n\n          this.setState({\n            currPoint: currEight[currEight.length - 1].id\n          });\n          currEight.pop();\n          this.setState({\n            movies: currEight\n          });\n        });\n      } else {\n        let movsInList = [];\n        let ref = firebase.database().ref('relations');\n        ref.once('value').then(snapshot => {\n          //ref.on('value', snapshot => {\n          let rels = snapshot.val();\n\n          for (let entry in rels) {\n            if (rels[entry].list === listChoice) {\n              movsInList.push(rels[entry].mov);\n            }\n          }\n\n          let movsRef = firebase.database().ref('movies');\n          movsRef.once('value').then(snapshot => {\n            //movsRef.on('value', snapshot => {\n            let movies = snapshot.val();\n            let newData = [];\n\n            for (let entry in movies) {\n              if (movsInList.includes(entry)) {\n                newData.push({\n                  id: entry,\n                  name: movies[entry].name,\n                  src: movies[entry].src,\n                  director: movies[entry].director,\n                  imdb: movies[entry].imdb,\n                  plot: movies[entry].plot\n                });\n              }\n            }\n\n            this.setState({\n              movies: newData\n            });\n            this.setState({\n              displayButton: 'none'\n            });\n          }); //ref.off();\n        });\n      }\n    };\n\n    this.state = {\n      currPoint: '',\n      lastMov: '',\n      movies: [],\n      lists: [],\n      listChoice: 'all',\n      displayButton: 'none',\n      shouldUpdate: false\n    };\n  }\n\n  enlarge(imgSrc, title, director, rating, plot, idVal) {\n    document.body.style.overflow = 'hidden';\n    var lbContent = document.createElement('img');\n    lbContent.className = 'movLightbox-content';\n    lbContent.src = imgSrc;\n    lbContent.id = 'lbContent';\n    var lbInfo = document.createElement('div');\n    lbInfo.className = 'movLightbox-info';\n    lbInfo.id = 'lbInfo';\n    lbInfo.innerHTML = '<span class=\\'title\\'>' + title + '</span><br/><span class=\\'director\\'>' + director + '</span><br/><br/><span class=\\'rating\\'>IMDb Rating: ' + rating + '</span><p>' + plot + '</p>';\n    var lbMovie = document.createElement('div');\n    lbMovie.id = 'lbMovie';\n    lbMovie.className = 'movLightbox-container';\n    var lightbox = document.createElement('div');\n    lightbox.id = 'lb';\n    lightbox.className = 'movLightbox';\n    var delButton = document.createElement('button');\n    delButton.id = 'delButton';\n    delButton.innerHTML = 'Delete Movie';\n\n    delButton.onclick = function () {\n      // Is there a way to do it without being inline?\n      if (window.confirm('Are you sure you want to delete ' + title + '?')) {\n        let ref = firebase.database().ref('movies');\n        ref.once('value').then(snapshot => {\n          //ref.on('value', snapshot => {\n          let movies = snapshot.val();\n\n          for (let entry in movies) {\n            if (entry === idVal) {\n              firebase.database().ref('movies/' + entry).remove();\n            }\n          }\n        });\n        let refList = firebase.database().ref('relations');\n        refList.once('value').then(snapshot => {\n          //refList.on('value', snapshot => {\n          let relations = snapshot.val();\n\n          for (let entry in relations) {\n            if (relations[entry].mov === idVal) {\n              firebase.database().ref('relations/' + entry).remove();\n            }\n          }\n        }); // Close lightbox\n\n        document.getElementById('lb').removeChild(document.getElementById('lbMovie'));\n        document.body.removeChild(document.getElementById('lb'));\n        document.body.style.overflow = 'auto';\n      }\n    };\n\n    var addList = document.createElement('select');\n    addList.id = 'add-list';\n    addList.style.marginTop = '10px';\n    addList.name = 'addLists';\n    let listRef = firebase.database().ref('lists');\n    let otherLists = [];\n    listRef.once('value').then(snapshot => {\n      //listRef.on('value', snapshot => {\n      let lists = snapshot.val();\n\n      for (let entry in lists) {\n        otherLists.push(lists[entry].name);\n      }\n\n      let relRef = firebase.database().ref('relations');\n      relRef.once('value').then(snapshot => {\n        //relRef.on('value', snapshot => {\n        let rels = snapshot.val();\n\n        for (let entry in rels) {\n          if (rels[entry].mov === idVal) {\n            let pos = otherLists.indexOf(rels[entry].list);\n            otherLists.splice(pos, 1);\n          }\n        }\n\n        var opt = document.createElement('option');\n        opt.value = '';\n        opt.innerHTML = 'Select List';\n        opt.disabled = 'true';\n        opt.selected = 'true';\n        opt.hidden = 'true';\n        addList.appendChild(opt);\n\n        for (var i in otherLists) {\n          opt = document.createElement('option');\n          opt.value = otherLists[i];\n          opt.innerHTML = otherLists[i];\n          addList.appendChild(opt);\n        }\n      });\n    });\n    var listDiv = document.createElement('div');\n    var listBtn = document.createElement('button');\n    listBtn.id = 'list-btn';\n    listBtn.innerHTML = 'Add to List';\n    listDiv.appendChild(addList);\n    listDiv.appendChild(listBtn);\n\n    listBtn.onclick = function () {\n      var choice = document.getElementById('add-list').value;\n\n      if (choice.length === 0) {\n        alert('No list selected.');\n      } else {\n        let formObj = {\n          mov: idVal,\n          list: choice\n        };\n        firebase.database().ref('relations').push().set(formObj);\n        alert('Successfully added ' + title + ' to ' + choice + ' list.');\n      }\n    };\n\n    document.body.appendChild(lightbox);\n    document.getElementById('lb').appendChild(lbMovie);\n    document.getElementById('lbMovie').appendChild(lbContent);\n    document.getElementById('lbMovie').appendChild(lbInfo);\n    document.getElementById('lbInfo').appendChild(listDiv);\n    document.getElementById('lbInfo').appendChild(delButton);\n    document.getElementById('lb').addEventListener('click', function (event) {\n      if (event.target.className === 'movLightbox') {\n        document.getElementById('lb').removeChild(document.getElementById('lbMovie'));\n        document.body.removeChild(document.getElementById('lb'));\n        document.body.style.overflow = 'auto';\n      }\n    });\n  }\n\n  componentWillUnmount() {\n    this.ref.off();\n    this.listRef.off();\n  }\n\n  componentDidMount() {\n    document.title = 'Great Movies';\n\n    if (!firebase.apps.length) {\n      firebase.initializeApp(config);\n    }\n\n    this.ref = firebase.database().ref('movies');\n    this.ref.on('value', snapshot => {\n      let movies = snapshot.val();\n      let newData = [];\n\n      for (let entry in movies) {\n        newData.push({\n          id: entry,\n          name: movies[entry].name,\n          src: movies[entry].src,\n          director: movies[entry].director,\n          imdb: movies[entry].imdb,\n          plot: movies[entry].plot\n        });\n      }\n\n      this.setState({\n        lastMov: newData[newData.length - 1]\n      });\n\n      if (newData.length < 9) {\n        //document.getElementById('pag-container').style.display = 'none';\n        this.setState({\n          displayButton: 'none'\n        });\n      } else {\n        //document.getElementById('pag-container').style.display = 'block';\n        this.setState({\n          displayButton: 'block'\n        });\n      } //this.setState({movies: newData});\n\n    }); // PAGINATION\n\n    let first = this.ref.orderByKey().limitToFirst(9);\n    first.on('value', snapshot => {\n      if (this.state.listChoice === 'all') {\n        let firstMovs = snapshot.val();\n        let currEight = [];\n\n        for (let entry in firstMovs) {\n          currEight.push({\n            id: entry,\n            name: firstMovs[entry].name,\n            src: firstMovs[entry].src,\n            director: firstMovs[entry].director,\n            imdb: firstMovs[entry].imdb,\n            plot: firstMovs[entry].plot\n          });\n        }\n\n        this.setState({\n          currPoint: currEight[currEight.length - 1].id\n        });\n        currEight.pop();\n        this.setState({\n          movies: currEight\n        });\n      } else {\n        let movsInList = [];\n        let ref = firebase.database().ref('relations');\n        ref.once('value').then(snapshot => {\n          //ref.on('value', snapshot => {\n          let rels = snapshot.val();\n\n          for (let entry in rels) {\n            if (rels[entry].list === this.state.listChoice) {\n              movsInList.push(rels[entry].mov);\n            }\n          }\n\n          let movsRef = firebase.database().ref('movies');\n          movsRef.once('value').then(snapshot => {\n            //movsRef.on('value', snapshot => {\n            let movies = snapshot.val();\n            let newData = [];\n\n            for (let entry in movies) {\n              if (movsInList.includes(entry)) {\n                newData.push({\n                  id: entry,\n                  name: movies[entry].name,\n                  src: movies[entry].src,\n                  director: movies[entry].director,\n                  imdb: movies[entry].imdb,\n                  plot: movies[entry].plot\n                });\n              }\n            }\n\n            this.setState({\n              movies: newData\n            });\n            this.setState({\n              displayButton: 'none'\n            });\n          }); //ref.off();\n        });\n      }\n    });\n    this.listRef = firebase.database().ref('lists');\n    this.listRef.on('value', snapshot => {\n      let lists = snapshot.val();\n      let newData = [];\n\n      for (let entry in lists) {\n        newData.push(lists[entry].name);\n      }\n\n      this.setState({\n        lists: newData\n      });\n    });\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    //only call set state here if it is wrapped in a condition\n    //if you initialize this.state.shouldUpdate and have not changed it yet then this will not run\n    if (this.state.shouldUpdate !== prevState.shouldUpdate) {\n      let ref = firebase.database().ref('movies');\n      ref.on('value', snapshot => {\n        let movies = snapshot.val();\n        let newData = [];\n\n        for (let entry in movies) {\n          newData.push({\n            id: entry,\n            name: movies[entry].name,\n            src: movies[entry].src,\n            director: movies[entry].director,\n            imdb: movies[entry].imdb,\n            plot: movies[entry].plot\n          });\n        }\n\n        this.setState({\n          lastMov: newData[newData.length - 1]\n        });\n\n        if (newData.length < 9) {\n          //document.getElementById('pag-container').style.display = 'none';\n          this.setState({\n            displayButton: 'none'\n          });\n        } else {\n          //document.getElementById('pag-container').style.display = 'block';\n          this.setState({\n            displayButton: 'block'\n          });\n        } //this.setState({movies: newData});\n\n      }); // PAGINATION\n\n      let first = ref.orderByKey().limitToFirst(9);\n      first.on('value', snapshot => {\n        let firstMovs = snapshot.val();\n        let currEight = [];\n\n        for (let entry in firstMovs) {\n          currEight.push({\n            id: entry,\n            name: firstMovs[entry].name,\n            src: firstMovs[entry].src,\n            director: firstMovs[entry].director,\n            imdb: firstMovs[entry].imdb,\n            plot: firstMovs[entry].plot\n          });\n        }\n\n        this.setState({\n          currPoint: currEight[currEight.length - 1].id\n        });\n        currEight.pop();\n        this.setState({\n          movies: currEight\n        });\n      });\n      let listRef = firebase.database().ref('lists');\n      listRef.on('value', snapshot => {\n        let lists = snapshot.val();\n        let newData = [];\n\n        for (let entry in lists) {\n          newData.push(lists[entry].name);\n        }\n\n        this.setState({\n          lists: newData\n        });\n      });\n    }\n  }\n\n  getMoreMovies() {\n    let ref = firebase.database().ref('movies');\n    let tmp = ref.orderByKey().startAt(this.state.currPoint);\n    let next = tmp.limitToFirst(9);\n    next.on('value', snapshot => {\n      let nextMovs = snapshot.val();\n      let currEight = [];\n\n      for (let entry in nextMovs) {\n        currEight.push({\n          id: entry,\n          name: nextMovs[entry].name,\n          src: nextMovs[entry].src,\n          director: nextMovs[entry].director,\n          imdb: nextMovs[entry].imdb,\n          plot: nextMovs[entry].plot\n        });\n      } // If last batch \n\n\n      if (currEight[currEight.length - 1].id === this.state.lastMov.id && currEight.length <= 8) {\n        this.setState({\n          displayButton: 'none'\n        });\n      } else {\n        this.setState({\n          currPoint: currEight[currEight.length - 1].id\n        });\n        currEight.pop();\n      }\n\n      let totalMovies = this.state.movies;\n      totalMovies = totalMovies.concat(currEight);\n      this.setState({\n        movies: totalMovies\n      });\n    });\n  }\n\n  searchMovies() {\n    let movChoice = document.getElementById('search').value.toLowerCase();\n    let ref = firebase.database().ref('movies');\n    ref.once('value').then(snapshot => {\n      //ref.on('value', snapshot => {\n      let movies = snapshot.val();\n      let newData = [];\n\n      for (let entry in movies) {\n        let title = movies[entry].name.toLowerCase();\n\n        if (title.includes(movChoice)) {\n          //newData.push(movies[entry].id);\n          newData.push({\n            id: entry,\n            name: movies[entry].name,\n            src: movies[entry].src,\n            director: movies[entry].director,\n            imdb: movies[entry].imdb,\n            plot: movies[entry].plot\n          });\n        }\n      } //if(newData.length < 9) {\n      //document.getElementById('pag-container').style.display = 'none';\n\n\n      this.setState({\n        displayButton: 'none'\n      });\n      /*} else {\n        //document.getElementById('pag-container').style.display = 'block';\n        this.setState({displayButton: 'block'});\n      }*/\n\n      this.setState({\n        movies: newData\n      });\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 469,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 470,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"top-bar\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 471,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"list-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 472,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"select\", {\n      name: \"listChoice\",\n      id: \"list\",\n      onChange: this.myChangeHandler,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 473,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"option\", {\n      value: \"all\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 474,\n        columnNumber: 17\n      }\n    }, \"All\"), this.state.lists.map(list => /*#__PURE__*/React.createElement(\"option\", {\n      value: list,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 477,\n        columnNumber: 21\n      }\n    }, list)))), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"search-bar\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 482,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      placeholder: \"Movie Title\",\n      name: \"search\",\n      id: \"search\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 483,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(\"button\", {\n      id: \"search-btn\",\n      onClick: this.searchMovies.bind(this),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 484,\n        columnNumber: 15\n      }\n    }, \"Search\"))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"mov-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 487,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(MovieGallery, {\n      movieList: this.state.movies,\n      enlarge: this.enlarge,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 488,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"pag-container\",\n      style: {\n        display: this.state.displayButton\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 490,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      id: \"pagination\",\n      onClick: this.getMoreMovies.bind(this),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 491,\n        columnNumber: 13\n      }\n    }, \"Load More\"))), /*#__PURE__*/React.createElement(\"button\", {\n      className: \"scrollButton\",\n      style: {\n        display: this.props.display\n      },\n      onClick: this.props.scrollToTop,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 494,\n        columnNumber: 9\n      }\n    }, \"Scroll to Top\"));\n  }\n\n}\nexport default Movies;","map":{"version":3,"sources":["C:/Users/Alex/Downloads/react-portfolio-master/react-portfolio-master/src/Components/Movies.js"],"names":["React","Component","MovieGallery","config","movies","require","firebase","Movies","constructor","props","myChangeHandler","event","field","target","name","value","setState","listChoice","document","getElementById","ref","database","once","then","snapshot","val","newData","entry","push","id","src","director","imdb","plot","lastMov","length","displayButton","first","orderByKey","limitToFirst","firstMovs","currEight","currPoint","pop","movsInList","rels","list","mov","movsRef","includes","state","lists","shouldUpdate","enlarge","imgSrc","title","rating","idVal","body","style","overflow","lbContent","createElement","className","lbInfo","innerHTML","lbMovie","lightbox","delButton","onclick","window","confirm","remove","refList","relations","removeChild","addList","marginTop","listRef","otherLists","relRef","pos","indexOf","splice","opt","disabled","selected","hidden","appendChild","i","listDiv","listBtn","choice","alert","formObj","set","addEventListener","componentWillUnmount","off","componentDidMount","apps","initializeApp","on","componentDidUpdate","prevProps","prevState","getMoreMovies","tmp","startAt","next","nextMovs","totalMovies","concat","searchMovies","movChoice","toLowerCase","render","map","bind","display","scrollToTop"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport MovieGallery from './MovieGallery';\nimport config from '../config.js';\nconst movies = require('../movies.json');\nconst firebase = require('firebase');\n\n/*\n  3. Pagination\n    - first only display 8\n    - display more by 8 (or less than 8 if not a multiple of 8)\n*/\n\nexport class Movies extends Component {\n  constructor(props) {\n    super();\n    this.state = {\n      currPoint: '',\n      lastMov: '',\n      movies: [],\n      lists: [],\n      listChoice: 'all',\n      displayButton: 'none',\n      shouldUpdate: false,\n    }\n  }\n\n  enlarge(imgSrc, title, director, rating, plot, idVal) {\n    document.body.style.overflow = 'hidden';\n    var lbContent = document.createElement('img');\n    lbContent.className = 'movLightbox-content';\n    lbContent.src = imgSrc;\n    lbContent.id = 'lbContent';\n\n    var lbInfo = document.createElement('div');\n    lbInfo.className = 'movLightbox-info';\n    lbInfo.id = 'lbInfo';\n    lbInfo.innerHTML = '<span class=\\'title\\'>'+title+'</span><br/><span class=\\'director\\'>'+director+'</span><br/><br/><span class=\\'rating\\'>IMDb Rating: '+rating+'</span><p>'+plot+'</p>';\n    \n    var lbMovie = document.createElement('div');\n    lbMovie.id = 'lbMovie';\n    lbMovie.className = 'movLightbox-container';\n    \n    var lightbox = document.createElement('div');\n    lightbox.id = 'lb';\n    lightbox.className = 'movLightbox';\n\n    var delButton = document.createElement('button');\n    delButton.id = 'delButton';\n    delButton.innerHTML = 'Delete Movie';\n    delButton.onclick = function () {\n      // Is there a way to do it without being inline?\n      if(window.confirm('Are you sure you want to delete '+title+'?')) {\n        let ref = firebase.database().ref('movies');\n        ref.once('value').then(snapshot => {\n        //ref.on('value', snapshot => {\n          let movies = snapshot.val();\n            for (let entry in movies) {\n              if(entry === idVal) {\n                firebase.database().ref('movies/'+entry).remove();\n              }\n            }\n        })\n\n        let refList = firebase.database().ref('relations');\n        refList.once('value').then(snapshot => {\n        //refList.on('value', snapshot => {\n          let relations = snapshot.val();\n            for (let entry in relations) {\n              if(relations[entry].mov === idVal) {\n                firebase.database().ref('relations/'+entry).remove();\n              }\n            }\n        })\n        // Close lightbox\n        document.getElementById('lb').removeChild(document.getElementById('lbMovie'));\n        document.body.removeChild(document.getElementById('lb'));\n        document.body.style.overflow = 'auto';\n      }\n    };\n\n    var addList = document.createElement('select');\n    addList.id = 'add-list';\n    addList.style.marginTop = '10px';\n    addList.name = 'addLists';\n    let listRef = firebase.database().ref('lists');\n    let otherLists = [];\n    listRef.once('value').then(snapshot => {\n    //listRef.on('value', snapshot => {\n      let lists = snapshot.val();\n        for (let entry in lists) {\n          otherLists.push(lists[entry].name);\n        }\n        let relRef = firebase.database().ref('relations');\n        relRef.once('value').then(snapshot => {\n        //relRef.on('value', snapshot => {\n          let rels = snapshot.val();\n            for (let entry in rels) {\n              if(rels[entry].mov === idVal) {\n                let pos = otherLists.indexOf(rels[entry].list);\n                otherLists.splice(pos, 1);\n              }\n            }\n            var opt = document.createElement('option');\n            opt.value = '';\n            opt.innerHTML = 'Select List';\n            opt.disabled = 'true';\n            opt.selected = 'true';\n            opt.hidden = 'true';\n            addList.appendChild(opt);\n            for(var i in otherLists) {\n              opt = document.createElement('option');\n              opt.value= otherLists[i];\n              opt.innerHTML = otherLists[i]; \n              addList.appendChild(opt);\n            }\n        });\n    });\n\n    var listDiv = document.createElement('div');\n    var listBtn = document.createElement('button');\n    listBtn.id = 'list-btn';\n    listBtn.innerHTML = 'Add to List';\n    listDiv.appendChild(addList);\n    listDiv.appendChild(listBtn);\n    listBtn.onclick = function () {\n      var choice = document.getElementById('add-list').value;\n      if(choice.length === 0) {\n        alert('No list selected.');\n      } else {\n        let formObj = {\n          mov: idVal, \n          list: choice,\n        };\n        firebase.database().ref('relations').push().set(formObj);\n        alert('Successfully added '+title+' to '+choice+' list.');\n      }\n    };\n   \n    document.body.appendChild(lightbox);  \n    document.getElementById('lb').appendChild(lbMovie);\n    document.getElementById('lbMovie').appendChild(lbContent);\n    document.getElementById('lbMovie').appendChild(lbInfo);\n    document.getElementById('lbInfo').appendChild(listDiv);\n    document.getElementById('lbInfo').appendChild(delButton);\n    document.getElementById('lb').addEventListener('click', function(event) {\n      if(event.target.className === 'movLightbox') {\n        document.getElementById('lb').removeChild(document.getElementById('lbMovie'));\n        document.body.removeChild(document.getElementById('lb'));\n        document.body.style.overflow = 'auto';\n      }\n    });\n  }\n\n  componentWillUnmount() {\n    this.ref.off();\n    this.listRef.off();\n  }\n\n  componentDidMount(){\n    document.title = 'Great Movies';\n    if (!firebase.apps.length) {\n      firebase.initializeApp(config);\n    }\n    this.ref = firebase.database().ref('movies');\n    this.ref.on('value', snapshot => {\n      let movies = snapshot.val();\n        let newData = [];\n        for (let entry in movies) {\n          newData.push({\n            id:  entry,\n            name:  movies[entry].name,\n            src:  movies[entry].src,\n            director:  movies[entry].director,\n            imdb:  movies[entry].imdb,\n            plot:  movies[entry].plot,\n          })\n        }\n        this.setState({lastMov: newData[newData.length-1]});\n        if(newData.length < 9) {\n          //document.getElementById('pag-container').style.display = 'none';\n          this.setState({displayButton: 'none'});\n        } else {\n          //document.getElementById('pag-container').style.display = 'block';\n          this.setState({displayButton: 'block'});\n        }\n        //this.setState({movies: newData});\n    });\n\n    // PAGINATION\n    let first = this.ref.orderByKey().limitToFirst(9);\n    first.on('value', snapshot => {\n      if(this.state.listChoice === 'all') {\n        let firstMovs = snapshot.val();\n        let currEight = [];\n        for (let entry in firstMovs) {\n          currEight.push({\n            id:  entry,\n            name:  firstMovs[entry].name,\n            src:  firstMovs[entry].src,\n            director:  firstMovs[entry].director,\n            imdb:  firstMovs[entry].imdb,\n            plot:  firstMovs[entry].plot,\n          });\n        }\n        this.setState({currPoint: currEight[currEight.length-1].id});\n        currEight.pop();\n        this.setState({movies: currEight});\n      } else {\n        let movsInList = [];\n        let ref = firebase.database().ref('relations');\n        ref.once('value').then(snapshot => {\n        //ref.on('value', snapshot => {\n          let rels = snapshot.val();\n          for (let entry in rels) {\n            if(rels[entry].list === this.state.listChoice) {\n              movsInList.push(rels[entry].mov);\n            }\n          }\n          let movsRef = firebase.database().ref('movies');\n          movsRef.once('value').then(snapshot => {\n          //movsRef.on('value', snapshot => {\n            let movies = snapshot.val();\n            let newData = [];\n            for (let entry in movies) {\n              if (movsInList.includes(entry)) {\n                newData.push({\n                  id:  entry,\n                  name:  movies[entry].name,\n                  src:  movies[entry].src,\n                  director:  movies[entry].director,\n                  imdb:  movies[entry].imdb,\n                  plot:  movies[entry].plot,\n                })\n              }\n            }\n            this.setState({movies: newData});\n            this.setState({displayButton: 'none'});\n          })\n          //ref.off();\n        })\n      }\n    });\n\n    this.listRef = firebase.database().ref('lists');\n    this.listRef.on('value', snapshot => {\n      let lists = snapshot.val();\n        let newData = [];\n        for (let entry in lists) {\n          newData.push(\n            lists[entry].name\n          )\n        }\n        this.setState({lists: newData});\n    })\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot){\n    //only call set state here if it is wrapped in a condition\n    //if you initialize this.state.shouldUpdate and have not changed it yet then this will not run\n    if(this.state.shouldUpdate !== prevState.shouldUpdate){\n      let ref = firebase.database().ref('movies');\n      ref.on('value', snapshot => {\n        let movies = snapshot.val();\n          let newData = [];\n          for (let entry in movies) {\n            newData.push({\n              id:  entry,\n              name:  movies[entry].name,\n              src:  movies[entry].src,\n              director:  movies[entry].director,\n              imdb:  movies[entry].imdb,\n              plot:  movies[entry].plot,\n            })\n          }\n          this.setState({lastMov: newData[newData.length-1]});\n          if(newData.length < 9) {\n            //document.getElementById('pag-container').style.display = 'none';\n            this.setState({displayButton: 'none'});\n          } else {\n            //document.getElementById('pag-container').style.display = 'block';\n            this.setState({displayButton: 'block'});\n          }\n          //this.setState({movies: newData});\n      });\n      // PAGINATION\n      let first = ref.orderByKey().limitToFirst(9);\n      first.on('value', snapshot => {\n        let firstMovs = snapshot.val();\n        let currEight = [];\n        for (let entry in firstMovs) {\n          currEight.push({\n            id:  entry,\n            name:  firstMovs[entry].name,\n            src:  firstMovs[entry].src,\n            director:  firstMovs[entry].director,\n            imdb:  firstMovs[entry].imdb,\n            plot:  firstMovs[entry].plot,\n          });\n        }\n        this.setState({currPoint: currEight[currEight.length-1].id});\n        currEight.pop();\n        this.setState({movies: currEight});\n      });\n      let listRef = firebase.database().ref('lists');\n      listRef.on('value', snapshot => {\n        let lists = snapshot.val();\n          let newData = [];\n          for (let entry in lists) {\n            newData.push(\n              lists[entry].name\n            )\n          }\n          this.setState({lists: newData});\n      })\n    }\n  }\n\n  getMoreMovies() {\n    let ref = firebase.database().ref('movies');\n    let tmp = ref.orderByKey().startAt(this.state.currPoint);\n    let next = tmp.limitToFirst(9);\n    next.on('value', snapshot => {\n      let nextMovs = snapshot.val();\n      let currEight = [];\n      for (let entry in nextMovs) {\n        currEight.push({\n          id:  entry,\n          name:  nextMovs[entry].name,\n          src:  nextMovs[entry].src,\n          director:  nextMovs[entry].director,\n          imdb:  nextMovs[entry].imdb,\n          plot:  nextMovs[entry].plot,\n        });\n      }\n      // If last batch \n      if(currEight[currEight.length-1].id === this.state.lastMov.id && currEight.length <= 8) {\n        this.setState({displayButton: 'none'});\n      } else {\n        this.setState({currPoint: currEight[currEight.length-1].id});\n        currEight.pop();\n      }\n      let totalMovies = this.state.movies;\n      totalMovies = totalMovies.concat(currEight);\n      this.setState({movies: totalMovies});\n    });\n  }\n\n  myChangeHandler = (event) => {\n    let field = event.target.name;\n    let value = event.target.value;\n    this.setState({[field]: value});\n    \n    let listChoice = document.getElementById('list').value;\n    if(listChoice === 'all') {\n      let ref = firebase.database().ref('movies');\n      ref.once('value').then(snapshot => {\n      //ref.on('value', snapshot => {\n        let movies = snapshot.val();\n          let newData = [];\n          for (let entry in movies) {\n            newData.push({\n              id:  entry,\n              name:  movies[entry].name,\n              src:  movies[entry].src,\n              director:  movies[entry].director,\n              imdb:  movies[entry].imdb,\n              plot:  movies[entry].plot,\n            })\n          }\n          this.setState({lastMov: newData[newData.length-1]});\n          if(newData.length < 9) {\n            this.setState({displayButton: 'none'});\n          } else {\n            this.setState({displayButton: 'block'});\n          }\n      });\n\n      // PAGINATION\n      let first = ref.orderByKey().limitToFirst(9);\n      first.once('value').then(snapshot => {\n      //first.on('value', snapshot => {\n        let firstMovs = snapshot.val();\n        let currEight = [];\n        for (let entry in firstMovs) {\n          currEight.push({\n            id:  entry,\n            name:  firstMovs[entry].name,\n            src:  firstMovs[entry].src,\n            director:  firstMovs[entry].director,\n            imdb:  firstMovs[entry].imdb,\n            plot:  firstMovs[entry].plot,\n          });\n        }\n        this.setState({currPoint: currEight[currEight.length-1].id});\n        currEight.pop();\n        this.setState({movies: currEight});\n      });\n    } else {\n      let movsInList = [];\n      let ref = firebase.database().ref('relations');\n      ref.once('value').then(snapshot => {\n      //ref.on('value', snapshot => {\n        let rels = snapshot.val();\n        for (let entry in rels) {\n          if(rels[entry].list === listChoice) {\n            movsInList.push(rels[entry].mov);\n          }\n        }\n        let movsRef = firebase.database().ref('movies');\n        movsRef.once('value').then(snapshot => {\n        //movsRef.on('value', snapshot => {\n          let movies = snapshot.val();\n          let newData = [];\n          for (let entry in movies) {\n            if (movsInList.includes(entry)) {\n              newData.push({\n                id:  entry,\n                name:  movies[entry].name,\n                src:  movies[entry].src,\n                director:  movies[entry].director,\n                imdb:  movies[entry].imdb,\n                plot:  movies[entry].plot,\n              })\n            }\n          }\n          this.setState({movies: newData});\n          this.setState({displayButton: 'none'});\n        })\n        //ref.off();\n      })\n    }\n  }\n\n  searchMovies() {\n    let movChoice = document.getElementById('search').value.toLowerCase();\n\n    let ref = firebase.database().ref('movies');\n    ref.once('value').then(snapshot => {\n    //ref.on('value', snapshot => {\n      let movies = snapshot.val();\n        let newData = [];\n        for (let entry in movies) {\n          let title = (movies[entry].name).toLowerCase();\n          if (title.includes(movChoice)) {\n            //newData.push(movies[entry].id);\n            newData.push({\n              id:  entry,\n              name:  movies[entry].name,\n              src:  movies[entry].src,\n              director:  movies[entry].director,\n              imdb:  movies[entry].imdb,\n              plot:  movies[entry].plot,\n            })\n          }\n        }\n        //if(newData.length < 9) {\n          //document.getElementById('pag-container').style.display = 'none';\n        this.setState({displayButton: 'none'});\n        /*} else {\n          //document.getElementById('pag-container').style.display = 'block';\n          this.setState({displayButton: 'block'});\n        }*/\n        this.setState({movies: newData});\n    })\n  }\n  \n  render() {\n    return (\n      <div>\n        <div className='content'>\n          <div id='top-bar'>\n            <div id='list-container'>\n              <select name='listChoice' id='list' onChange={this.myChangeHandler}>\n                <option value='all'>All</option>\n                {\n                  this.state.lists.map((list) => (\n                    <option value={list}>{list}</option>\n                  ))\n                }\n              </select>\n            </div>\n            <div id='search-bar'>\n              <input type='text' placeholder='Movie Title' name='search' id='search' />\n              <button id='search-btn' onClick={this.searchMovies.bind(this)}>Search</button>\n            </div>\n          </div>\n          <div className='mov-container'>\n            <MovieGallery movieList={this.state.movies} enlarge={this.enlarge} />\n          </div>\n          <div id='pag-container' style={{display: this.state.displayButton}}>\n            <button id='pagination' onClick={this.getMoreMovies.bind(this)}>Load More</button>\n          </div>\n        </div>\n        <button className='scrollButton' style={{display: this.props.display}} onClick={this.props.scrollToTop}>Scroll to Top</button>\n      </div>\n    );\n  }\n}\nexport default Movies;"]},"metadata":{},"sourceType":"module"}